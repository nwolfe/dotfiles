# vim: filetype=sh

export PUPPETLABS=/Users/nwolfe/workspace/puppetlabs
DEFAULT_PUPPET_TESTDIR=$PUPPETLABS/conf/puppet

function puppetenv() {
  local PUPPET_HOME=$PUPPETLABS/puppet
  local FACTER_HOME=$PUPPETLABS/facter
  export RUBYLIB=$PUPPET_HOME/lib:$FACTER_HOME/lib
  export PATH=$PATH:$PUPPET_HOME/bin:$FACTER_HOME/bin
  export RUBYLIB=$RUBYLIB:$PUPPETLABS/puppetdb/puppet/lib
}

function runmaster() {
  local TESTDIR=${1:-$DEFAULT_PUPPET_TESTDIR}
  local COMMAND="puppet master --autosign=true --no-daemonize --debug --verbose --confdir=$TESTDIR/master/conf --vardir=$TESTDIR/master/var --certname localhost"
  echo $COMMAND
  echo -n $COMMAND | pbcopy
}

function runagent() {
  local DEFAULT_TESTDIR=/Users/nwolfe/workspace/puppetlabs/conf/puppet
  local TESTDIR=${1:-$DEFAULT_PUPPET_TESTDIR}
  local COMMAND="puppet agent --no-daemonize --debug --trace --verbose --confdir=$TESTDIR/agent/conf --vardir=$TESTDIR/agent/var --server localhost --onetime --certname localhost-puppetdb"
  echo $COMMAND
  echo -n $COMMAND | pbcopy
}

# Set environment variables to make PuppetDB use PostgreSQL instead of HSQL
function puppetdbpgenv() {
  export PUPPETDB_DBTYPE=postgres
  export PUPPETDB_DBSUBNAME=puppetdb_tests
  export PUPPETDB_DBUSER=puppetdb
  export PUPPETDB_DBPASSWORD=puppetdb
}

function runpuppetdb() {
  cd $PUPPETLABS/puppetdb
  lein run services -c $PUPPETLABS/conf/puppetdb/config.ini
}
